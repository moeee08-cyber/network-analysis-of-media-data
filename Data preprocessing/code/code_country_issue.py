mappings = {
    "economy": [
        "ECON_TAXATION", "UNEMPLOYMENT", "ECON_BANKRUPTCY", "ECON_BOYCOTT", "ECON_COST_OF_LIVING",
        "ECON_CURRENCY_EXCHANGE_RATE", "ECON_CURRENCY_RESERVES", "ECON_CUTOUTLOOK", "ECON_DEBT",
        "ECON_DEREGULATION", "ECON_EARNINGSREPORT", "ECON_ENTREPRENEURSHIP", "ECON_FOREIGNINVEST",
        "ECON_FREETRADE", "ECON_HOUSING_PRICES", "ECON_INFORMAL_ECONOMY", "ECON_IPO",
        "ECON_INTEREST_RATE", "ECON_MONOPOLY", "ECON_MOU", "ECON_NATIONALIZE", "ECON_PRICECONTROL",
        "ECON_REMITTANCE", "ECON_STOCKMARKET", "ECON_SUBSIDIES", "ECON_TRADE_DISPUTE", "ECON_UNIONS",
        "SANCTIONS", "SLFID_ECONOMIC_DEVELOPMENT", "SLFID_ECONOMIC_POWER", "SOC_ECONCOOP"
    ],
    "military&terrorism": [
        "ACT_FORCEPOSTURE", "ALLIANCE", "ARMEDCONFLICT", "BLOCKADE", "CEASEFIRE", "EXTREMISM",
        "MARITIME_PIRACY", "MILITARY", "MILITARY_COOPERATION", "PEACEKEEPING", "RELATIONS",
        "RETALIATE", "SEIGE", "SLFID_MILITARY_BUILDUP", "SLFID_MILITARY_READINESS",
        "SLFID_MILITARY_SPENDING", "SLFID_PEACE_BUILDING", "SOC_DIPLOMCOOP", "TAX_TERROR_GROUP",
        "TAX_MILITARY_TITLE", "TERROR", "WMD"
    ],
    "borderissues": [
        "BORDER", "CHECKPOINT", "DEFECTION", "DISPLACED", "EVACUATION", "EXILE", "IMMIGRATION",
        "REFUGEES", "SOC_FORCEDRELOCATION", "SOC_MASSMIGRATION", "UNREST_CHECKPOINT", "UNREST_CLOSINGBORDER"
    ],
    "healthcare": [
        "DISABILITY", "GENERAL_HEALTH", "HEALTH_SEXTRANSDISEASE", "HEALTH_VACCINATION", "MEDICAL",
        "MEDICAL_SECURITY", "PUBLIC_HEALTH"
    ],
    "publicorder": [
        "ARREST", "ASSASSINATION", "BAN", "BLACK_MARKET", "CONFISCATION", "CRIME_CARTELS",
        "CRIME_COMMON_ROBBERY", "CRIME_ILLEGAL_DRUGS", "CURFEW", "DEATH_PENALTY", "DISCRIMINATION",
        "DRUG_TRADE", "FIREARM_OWNERSHIP", "HATE_SPEECH", "HUMAN_TRAFFICKING", "KIDNAP", "LANDMINE",
        "MIL_SELF_IDENTIFIED_ARMS_DEAL", "MIL_WEAPONS_PROLIFERATION", "ORGANIZED_CRIME", "PROTEST",
        "RAPE", "REBELLION", "REBELS", "SEIZE", "SLFID_RULE_OF_LAW", "SMUGGLING", "SOC_GENERALCRIME",
        "SOC_SUSPICIOUSACTIVITIES", "SOC_SUSPICIOUSPEOPLE", "TAX_CARTELS", "TRIAL",
        "UNREST_MOLOTOVCOCKTAIL", "UNREST_POLICEBRUTALITY", "UNREST_STONETHROWING", "UNREST_STONING",
        "VANDALIZE", "VIOLENT_UNREST"
    ],
    "civil_liberties": [
        "GENDER_VIOLENCE", "LGBT", "MOVEMENT_SOCIAL", "MOVEMENT_WOMENS", "SLFID_CIVIL_LIBERTIES"
    ],
    "environment": [
        "AGRICULTURE", "ENV_BIOFUEL", "ENV_CARBONCAPTURE", "ENV_CLIMATECHANGE", "ENV_COAL",
        "ENV_DEFORESTATION", "ENV_FISHERY", "ENV_FORESTRY", "ENV_GEOTHERMAL", "ENV_GREEN",
        "ENV_HYDRO", "ENV_METALS", "ENV_MINING", "ENV_NATURALGAS", "ENV_NUCLEARPOWER", "ENV_OIL",
        "ENV_OVERFISH", "ENV_POACHING", "ENV_WATERWAYS", "ENV_SOLAR", "ENV_SPECIESENDANGERED",
        "ENV_SPECIESEXTINCT", "ENV_WINDPOWER", "ETH_INDIGINOUS", "FUELPRICES", "MOVEMENT_ENVIRONMENTAL",
        "SELF_IDENTIFIED_ENVIRON_DISASTER", "SLFID_MINERAL_RESOURCES", "SLFID_NATURAL_RESOURCES",
        "WATER_SECURITY"
    ],
    "education": ["EDUCATION", "LITERACY"],
    "politics": [
        "CHARASMATIC_LEADERSHIP", "CONSTITUTIONAL", "DEMOCRACY", "ELECTION", "RESIGNATION",
        "ELECTION_FRAUD", "GENERAL_GOVERNMENT", "GOV_DISSOLVEGOV", "GOV_DIVISIONOFPOWER",
        "GOV_INTERGOVERNMENTAL", "GOV_REFORM", "GOV_REPATRIATION", "IMPEACHMENT", "LEADER", "LEGALIZE",
        "LEGISLATION", "POLITICAL_TURMOIL", "PROPAGANDA", "RATIFY", "SEPARATISTS", "SLFID_DICTATORSHIP",
        "SLFID_POLITICAL_BOUNDARIES", "SOC_JUDICIALCOOP", "TAKE_OFFICE", "TAX_POLITICAL_PARTY",
        "UNGOVERNED", "VETO"
    ],
    "poverty": ["FOOD_SECURITY", "FOOD_STAPLE", "POVERTY", "SLUMS"],
    "disaster": [
        "AVIATION_INCIDENT", "HEALTH_PANDEMIC", "LOCUSTS", "MANMADE_DISASTER", "MANMADE_DISASTER_IMPLIED",
        "MARITIME_INCIDENT", "MARITIME_INCIDENT_IMPLIED", "MARITIME_INCIDENT_SELF_IDENTIFIED",
        "NATURAL_DISASTER", "PIPELINE_INCIDENT", "POWER_OUTAGE", "RAIL_INCIDENT", "ROAD_INCIDENT",
        "SELF_IDENTIFIED_HUMANITARIAN_CRISIS", "SHORTAGE", "SOC_TRAFFICACCIDENT", "TAX_DISEASE"
    ],
    "religion": ["IDEOLOGY", "REL_ANTISEMITISM", "RELIGION", "TAX_RELIGION"],
    "infrastructure": [
        "INFRASTRUCTURE_BAD_ROADS", "NEW_CONSTRUCTION", "PROPERTY_RIGHTS", "PUBLIC_TRANSPORT",
        "TRAFFIC", "URBAN", "URBAN_SPRAWL"
    ],
    "media/internet": [
        "CYBER_ATTACK", "INTERNET_BLACKOUT", "INTERNET_CENSORSHIP", "MEDIA_CENSORSHIP", "MEDIA_MSM",
        "MEDIA_SOCIAL", "SURVEILLANCE"
    ]
}

#to be updated
countries = [
   'United Arab Emirates', 'Afghanistan', 'Australia', 'Austria', 'Belgium',
   'Belize', 'Canada', 'Sri Lanka', 'China', 'Egypt', 'Ireland', 'Finland',
   'Fiji', 'France', 'Gambia', 'Ghana', 'Germany', 'Greece', 'Haiti',
   'Hungary', 'Indonesia', 'India', 'Iran', 'Italy', 'Iraq', 'Japan',
   'Jamaica', 'Kenya', 'South Korea', 'Malawi', 'Mexico', 'Malaysia',
   'Nigeria', 'Netherlands', 'Nepal', 'New Zealand', 'Pakistan', 'Poland',
   'Philippines', 'Russia', 'Rwanda', 'Saudi Arabia', 'Seychelles',
   'South Africa', 'Senegal', 'Sierra Leone', 'Singapore', 'Spain',
   'Sudan', 'Sweden', 'Thailand', 'Turkey', 'United Kingdom', 'United States',
   'Vietnam', 'Zambia'
]

import pandas as pd

def process_excel_file(file_path, mappings):
    """
    处理Excel文件并标记匹配项
    """
    print(f"Reading file: {file_path}")
    df = pd.read_excel(file_path)
    
    # 获取G和H列
    col_g = df.iloc[:, 6].astype(str)
    col_h = df.iloc[:, 7].astype(str)
    
    # 处理每个mapping
    for key, values in mappings.items():
        print(f"Processing mapping: {key}")
        df[key] = 0
        
        # 遍历每一行
        for idx in range(len(df)):
            # 分割并清理字符串
            g_items = [x.split(',')[0].strip() for x in col_g.iloc[idx].split(';')]
            h_items = [x.split(',')[0].strip() for x in col_h.iloc[idx].split(';')]
            
            # 检查是否有匹配项
            if any(v in g_items for v in values) or any(v in h_items for v in values):
                df.loc[idx, key] = 1
                
    col_g = df.iloc[:, 8].astype(str)
    col_h = df.iloc[:, 9].astype(str)
   
   # 处理每个country
    for country in countries:
       print(f"Processing country: {country}")
       df[country] = 0
       
       # 遍历每一行
       for idx in range(len(df)):
           # 分割并清理字符串，用分号分割多个地点
           locations = col_g.iloc[idx].split(';') + col_h.iloc[idx].split(';')
           
           # 对每个地点进行处理
           for location in locations:
               # 用#分割地点的各个部分，取第二部分（地点名）
               if '#' in location:
                   place = location.split('#')[1].strip()
                   # 如果地点名包含国家名，将对应的列标记为1
                   if country in place:
                       df.loc[idx, country] = 1
                       break  # 找到匹配就跳出内部循环
   
    return df


df = process_excel_file('/Users/wumengmeng/Desktop/project-MediaAgenda/two-mode/step1testcode/step2_code_data/exploratory analysis/canada_filtered0105.xlsx', mappings)
df.to_excel('canada_code0105.xlsx', index=False)